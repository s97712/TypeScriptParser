<Project>

  <!-- 自动检测运行时标识符 -->
  <PropertyGroup>
    <TypeScriptParserRuntimeIdentifier Condition="'$(RuntimeIdentifier)' != ''">$(RuntimeIdentifier)</TypeScriptParserRuntimeIdentifier>
    <TypeScriptParserRuntimeIdentifier Condition="'$(TypeScriptParserRuntimeIdentifier)' == '' AND $([MSBuild]::IsOSPlatform('Windows'))">win-x64</TypeScriptParserRuntimeIdentifier>
    <TypeScriptParserRuntimeIdentifier Condition="'$(TypeScriptParserRuntimeIdentifier)' == '' AND $([MSBuild]::IsOSPlatform('Linux'))">linux-x64</TypeScriptParserRuntimeIdentifier>
    <TypeScriptParserRuntimeIdentifier Condition="'$(TypeScriptParserRuntimeIdentifier)' == '' AND $([MSBuild]::IsOSPlatform('OSX'))">osx-arm64</TypeScriptParserRuntimeIdentifier>
    
    <TypeScriptParserNativePath>$(MSBuildThisFileDirectory)../runtimes/$(TypeScriptParserRuntimeIdentifier)/native/</TypeScriptParserNativePath>
  </PropertyGroup>

  <!-- 包含native库文件到输出目录 -->
  <ItemGroup Condition="Exists('$(TypeScriptParserNativePath)')">
    <TypeScriptParserNativeFiles Include="$(TypeScriptParserNativePath)**/*" />
    <None Include="@(TypeScriptParserNativeFiles)" CopyToOutputDirectory="PreserveNewest" />
  </ItemGroup>

  <!-- 发布时包含native库文件 -->
  <ItemGroup Condition="'$(PublishDir)' != '' AND Exists('$(TypeScriptParserNativePath)')">
    <ResolvedFileToPublish Include="@(TypeScriptParserNativeFiles)">
      <RelativePath>%(Filename)%(Extension)</RelativePath>
      <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
      <ExcludeFromSingleFile Condition="'$(PublishSingleFile)' == 'true'">true</ExcludeFromSingleFile>
    </ResolvedFileToPublish>
  </ItemGroup>

</Project>